CREATE EXTERNAL TABLE C_PART 
(P_PARTKEY INT, P_NAME VARCHAR(55), P_MFGR VARCHAR(25), P_BRAND VARCHAR(10), P_TYPE VARCHAR(25), P_SIZE INT, P_CONTAINER VARCHAR(10), P_RETAILPRICE DECIMAL, P_COMMENT VARCHAR(23)) 
ROW FORMAT DELIMITED FIELDS TERMINATED BY '|' 
LOCATION 's3://331982-tpch/1GB/CSV/part/';

CREATE EXTERNAL TABLE PART 
(P_PARTKEY INT, P_NAME VARCHAR(55), P_MFGR VARCHAR(25), P_BRAND VARCHAR(10), P_TYPE VARCHAR(25), P_SIZE INT, P_CONTAINER VARCHAR(10), P_RETAILPRICE DECIMAL, P_COMMENT VARCHAR(23)) 
STORED AS PARQUET
LOCATION 's3://331982-tpch/1GB/PAR/part/';

CREATE EXTERNAL TABLE C_SUPPLIER 
(S_SUPPKEY INT, S_NAME VARCHAR(25), S_ADDRESS VARCHAR(40), S_NATIONKEY BIGINT, S_PHONE VARCHAR(15), S_ACCTBAL DECIMAL, S_COMMENT VARCHAR(101)) 
ROW FORMAT DELIMITED FIELDS TERMINATED BY '|' 
LOCATION 's3://331982-tpch/1GB/CSV/supplier/';

CREATE EXTERNAL TABLE SUPPLIER 
(S_SUPPKEY INT, S_NAME VARCHAR(25), S_ADDRESS VARCHAR(40), S_NATIONKEY BIGINT, S_PHONE VARCHAR(15), S_ACCTBAL DECIMAL, S_COMMENT VARCHAR(101)) 
STORED AS PARQUET
LOCATION 's3://331982-tpch/1GB/PAR/supplier/';

CREATE EXTERNAL TABLE C_PARTSUPP 
(PS_PARTKEY BIGINT, PS_SUPPKEY BIGINT, PS_AVAILQTY INT, PS_SUPPLYCOST DECIMAL, PS_COMMENT VARCHAR(199))
ROW FORMAT DELIMITED FIELDS TERMINATED BY '|'
LOCATION 's3://331982-tpch/1GB/CSV/partsupp/';

CREATE EXTERNAL TABLE PARTSUPP 
(PS_PARTKEY BIGINT, PS_SUPPKEY BIGINT, PS_AVAILQTY INT, PS_SUPPLYCOST DECIMAL, PS_COMMENT VARCHAR(199))
STORED AS PARQUET
LOCATION 's3://331982-tpch/PAR/PAR/partsupp/';

CREATE EXTERNAL TABLE C_CUSTOMER 
(C_CUSTKEY INT, C_NAME VARCHAR(25), C_ADDRESS VARCHAR(40), C_NATIONKEY BIGINT, C_PHONE VARCHAR(15), C_ACCTBAL DECIMAL, C_MKTSEGMENT VARCHAR(10), C_COMMENT VARCHAR(117))
ROW FORMAT DELIMITED FIELDS TERMINATED BY '|'
LOCATION 's3://331982-tpch/1GB/CSV/customer/';

CREATE EXTERNAL TABLE CUSTOMER 
(C_CUSTKEY INT, C_NAME VARCHAR(25), C_ADDRESS VARCHAR(40), C_NATIONKEY BIGINT, C_PHONE VARCHAR(15), C_ACCTBAL DECIMAL, C_MKTSEGMENT VARCHAR(10), C_COMMENT VARCHAR(117))
STORED AS PARQUET
LOCATION 's3://331982-tpch/1GB/PAR/customer/';

CREATE EXTERNAL TABLE C_ORDERS
(O_ORDERKEY INT, O_CUSTKEY BIGINT, O_ORDERSTATUS VARCHAR(1), O_TOTALPRICE DECIMAL, O_ORDERDATE DATE, O_ORDERPRIORITY VARCHAR(15), O_CLERK VARCHAR(15), O_SHIPPRIORITY INT, O_COMMENT VARCHAR(79))
ROW FORMAT DELIMITED FIELDS TERMINATED BY '|'
LOCATION 's3://331982-tpch/1GB/CSV/orders/';

CREATE EXTERNAL TABLE ORDERS
(O_ORDERKEY INT, O_CUSTKEY BIGINT, O_ORDERSTATUS VARCHAR(1), O_TOTALPRICE DECIMAL, O_ORDERDATE DATE, O_ORDERPRIORITY VARCHAR(15), O_CLERK VARCHAR(15), O_SHIPPRIORITY INT, O_COMMENT VARCHAR(79))
STORED AS PARQUET
LOCATION 's3://331982-tpch/1GB/PAR/orders/';

CREATE EXTERNAL TABLE C_LINEITEM 
(L_ORDERKEY BIGINT, L_PARTKEY BIGINT, L_SUPPKEY BIGINT, L_LINENUMBER INT, L_QUANTITY DECIMAL, L_EXTENDEDPRICE DECIMAL, L_DISCOUNT DECIMAL, L_TAX DECIMAL, L_RETURNFLAG VARCHAR(1), L_LINESTATUS VARCHAR(1), L_SHIPDATE DATE, L_COMMITDATE DATE, L_RECEIPTDATE DATE, L_SHIPINSTRUCT VARCHAR(25), L_SHIPMODE VARCHAR(10), L_COMMENT VARCHAR(44))
ROW FORMAT DELIMITED FIELDS TERMINATED BY '|'
LOCATION 's3://331982-tpch/1GB/CSV/lineitem/';

CREATE EXTERNAL TABLE LINEITEM 
(L_ORDERKEY BIGINT, L_PARTKEY BIGINT, L_SUPPKEY BIGINT, L_LINENUMBER INT, L_QUANTITY DECIMAL, L_EXTENDEDPRICE DECIMAL, L_DISCOUNT DECIMAL, L_TAX DECIMAL, L_RETURNFLAG VARCHAR(1), L_LINESTATUS VARCHAR(1), L_SHIPDATE DATE, L_COMMITDATE DATE, L_RECEIPTDATE DATE, L_SHIPINSTRUCT VARCHAR(25), L_SHIPMODE VARCHAR(10), L_COMMENT VARCHAR(44))
STORED AS PARQUET
LOCATION 's3://331982-tpch/1GB/PAR/lineitem/';

CREATE EXTERNAL TABLE C_NATION
(N_NATIONKEY INT, N_NAME VARCHAR(25), N_REGIONKEY BIGINT, N_COMMENT VARCHAR(152))
ROW FORMAT DELIMITED FIELDS TERMINATED BY '|'
LOCATION 's3://331982-tpch/1GB/CSV/nation/';

CREATE EXTERNAL TABLE NATION
(N_NATIONKEY INT, N_NAME VARCHAR(25), N_REGIONKEY BIGINT, N_COMMENT VARCHAR(152))
STORED AS PARQUET
LOCATION 's3://331982-tpch/1GB/PAR/nation/';

CREATE EXTERNAL TABLE C_REGION
(R_REGIONKEY INT, R_NAME VARCHAR(25), R_COMMENT VARCHAR(152))
ROW FORMAT DELIMITED FIELDS TERMINATED BY '|'
LOCATION 's3://331982-tpch/1GB/CSV/region/';

CREATE EXTERNAL TABLE REGION
(R_REGIONKEY INT, R_NAME VARCHAR(25), R_COMMENT VARCHAR(152))
STORED AS PARQUET
LOCATION 's3://331982-tpch/1GB/PAR/region/';


INSERT OVERWRITE TABLE PART SELECT * FROM C_PART;
INSERT OVERWRITE TABLE CUSTOMER SELECT * FROM C_CUSTOMER;
INSERT OVERWRITE TABLE LINEITEM SELECT * FROM C_LINEITEM;
INSERT OVERWRITE TABLE NATION SELECT * FROM C_NATION;
INSERT OVERWRITE TABLE ORDERS SELECT * FROM C_ORDERS;
INSERT OVERWRITE TABLE PARTSUPP SELECT * FROM C_PARTSUPP;
INSERT OVERWRITE TABLE REGION SELECT * FROM C_REGION;
INSERT OVERWRITE TABLE SUPPLIER SELECT * FROM C_SUPPLIER;


DROP TABLE C_CUSTOMER;
DROP TABLE C_LINEITEM;
DROP TABLE C_NATION;
DROP TABLE C_PART;
DROP TABLE C_ORDERS;
DROP TABLE C_PARTSUPP;
DROP TABLE C_REGION;
DROP TABLE C_SUPPLIER;
DROP TABLE CUSTOMER;
DROP TABLE LINEITEM;
DROP TABLE NATION;
DROP TABLE PART;
DROP TABLE ORDERS;
DROP TABLE PARTSUPP;
DROP TABLE REGION;
DROP TABLE SUPPLIER;




select
s_acctbal,
s_name,
n_name,
p_partkey,
p_mfgr,
s_address,
s_phone,
s_comment
from
part,
supplier,
partsupp,
nation,
c_region
where
p_partkey = ps_partkey
and s_suppkey = ps_suppkey
and p_size = 15
and p_type like '%BRASS'
and s_nationkey = n_nationkey
and n_regionkey = r_regionkey
and r_name = 'EUROPE'
and ps_supplycost = (
select
min(ps_supplycost)
from
partsupp, supplier,
nation, c_region
where
p_partkey = ps_partkey
and s_suppkey = ps_suppkey
and s_nationkey = n_nationkey
and n_regionkey = r_regionkey
and r_name = 'EUROPE'
)
order by
s_acctbal desc,
n_name,
s_name,
p_partkey;
